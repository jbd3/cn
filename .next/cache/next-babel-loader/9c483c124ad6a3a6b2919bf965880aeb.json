{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport nextConnect from 'next-connect';\nimport middleware from '../../database';\nimport randomWords from 'random-words';\nimport words from '../../words.json';\nconst handler = nextConnect();\nhandler.use(middleware);\nhandler.get(async (req, res) => {\n  const {\n    token\n  } = req.query;\n\n  try {\n    const game = await req.db.collection('games').findOne({\n      token\n    });\n    res.json(game);\n  } catch (err) {\n    throw new Error(`Error loadin game with token: ${token}: ${err}`);\n  }\n});\nhandler.post(async (req, res) => {\n  const {\n    token,\n    officialWords\n  } = req.body;\n\n  const randomInt = (min, max) => {\n    return Math.round(min + Math.random() * (max - min));\n  };\n\n  const getWord = ({\n    doNotInclude = {},\n    isOfficial\n  }) => {\n    const doNotIncludeList = _objectSpread({}, doNotInclude);\n\n    let word = isOfficial ? words.list[randomInt(0, words.list.length - 1)] : randomWords();\n\n    while (doNotIncludeList[word]) {\n      word = isOfficial ? words.list[randomInt(0, words.list.length - 1)] : randomWords();\n    }\n\n    doNotIncludeList[word] = true;\n    return word;\n  };\n\n  const firstPlayer = req.query.firstPlayer || Math.random() >= 0.5 ? 1 : 2;\n  const boardMap = [];\n\n  for (let i = 0; i < 5; i++) {\n    const row = [];\n\n    for (let j = 0; j < 5; j++) {\n      row.push({\n        word: officialWords ? getWord({\n          isOfficial: true\n        }) : getWord({\n          isOfficial: false\n        }),\n        team: 0,\n        isRevealed: false\n      });\n    }\n\n    boardMap.push(row);\n  }\n\n  const addCardOwner = int => {\n    let x = randomInt(0, 4);\n    let y = randomInt(0, 4);\n\n    while (boardMap[x][y].team !== 0) {\n      x = randomInt(0, 4);\n      y = randomInt(0, 4);\n    }\n\n    boardMap[x][y].team = int;\n  };\n\n  for (let i = 0; i < 9; i++) {\n    addCardOwner(firstPlayer === 1 ? 1 : 2);\n\n    if (i !== 0) {\n      addCardOwner(firstPlayer === 1 ? 2 : 1);\n    }\n  }\n\n  addCardOwner(3);\n  const game = {\n    token,\n    boardMap,\n    players: {\n      blue: [],\n      red: []\n    }\n  };\n\n  try {\n    const result = await req.db.collection('games').insertOne(game);\n    console.log(`New game created with the following id: ${result.insertedId} `);\n    res.json(token);\n  } catch (err) {\n    throw new Error(`Error adding new game: ${err}`);\n  }\n});\nhandler.put(async (req, res) => {\n  const {\n    x,\n    y,\n    token\n  } = req.body;\n\n  try {\n    const game = await req.db.collection('games').findOne({\n      token\n    });\n    game.boardMap;\n  } catch (err) {\n    throw new Error(`Error on guess: ${err}`);\n  }\n});\nexport default handler;","map":{"version":3,"sources":["/Users/jakedouglas 1/development/nextJs/cn/pages/api/games.js"],"names":["nextConnect","middleware","randomWords","words","handler","use","get","req","res","token","query","game","db","collection","findOne","json","err","Error","post","officialWords","body","randomInt","min","max","Math","round","random","getWord","doNotInclude","isOfficial","doNotIncludeList","word","list","length","firstPlayer","boardMap","i","row","j","push","team","isRevealed","addCardOwner","int","x","y","players","blue","red","result","insertOne","console","log","insertedId","put"],"mappings":"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","sourcesContent":["import nextConnect from 'next-connect';\nimport middleware from '../../database';\nimport randomWords from 'random-words';\nimport words from '../../words.json';\n\nconst handler = nextConnect();\n\nhandler.use(middleware);\n\nhandler.get(async (req, res) => {\n  const { token } = req.query;\n  try {\n    const game = await req.db.collection('games').findOne({ token });\n    res.json(game);\n  } catch (err) {\n    throw new Error(`Error loadin game with token: ${token}: ${err}`);\n  }\n});\n\nhandler.post(async (req, res) => {\n  const { token, officialWords } = req.body;\n\n  const randomInt = (min, max) => {\n    return Math.round(min + (Math.random() * (max - min)));\n  };\n\n  const getWord = ({ doNotInclude = {}, isOfficial }) => {\n    const doNotIncludeList = { ...doNotInclude };\n    let word = isOfficial ? words.list[randomInt(0, words.list.length - 1)] : randomWords();\n    while (doNotIncludeList[word]) {\n      word = isOfficial ? words.list[randomInt(0, words.list.length - 1)] : randomWords();\n    }\n    doNotIncludeList[word] = true;\n    return word;\n  };\n\n  const firstPlayer = req.query.firstPlayer || Math.random() >= 0.5 ? 1 : 2;\n  const boardMap = [];\n  for (let i = 0; i < 5; i++) {\n    const row = [];\n    for (let j = 0; j < 5; j++) {\n      row.push({\n        word: officialWords ? getWord({ isOfficial: true }) : getWord({ isOfficial: false }),\n        team: 0,\n        isRevealed: false,\n      });\n    }\n    boardMap.push(row);\n  }\n  const addCardOwner = (int) => {\n    let x = randomInt(0, 4);\n    let y = randomInt(0, 4);\n    while (boardMap[x][y].team !== 0) {\n      x = randomInt(0, 4);\n      y = randomInt(0, 4);\n    }\n    boardMap[x][y].team = int;\n  }\n  for (let i = 0; i < 9; i++) {\n    addCardOwner(firstPlayer === 1 ? 1 : 2);\n    if (i !== 0) {\n      addCardOwner(firstPlayer === 1 ? 2 : 1);\n    }\n  }\n  addCardOwner(3);\n  const game = {\n    token,\n    boardMap,\n    players: {\n      blue: [],\n      red: [],\n    },\n  };\n  try {\n    const result = await req.db.collection('games').insertOne(game);\n    console.log(`New game created with the following id: ${result.insertedId} `);\n    res.json(token);\n  } catch (err) {\n    throw new Error(`Error adding new game: ${err}`)\n  }\n});\n\nhandler.put(async (req, res) => {\n  const { x, y, token } = req.body;\n  try {\n    const game = await req.db.collection('games').findOne({ token });\n    game.boardMap\n  } catch (err) {\n    throw new Error(`Error on guess: ${err}`);\n  }\n});\n\nexport default handler;\n"]},"metadata":{},"sourceType":"module"}